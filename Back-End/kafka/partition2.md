# Kafka Partition

Kafka 파티션은 데이터를 효율적으로 처리하는 데 필수적인 역할을 한다.

각각의 파티션은 독립적인 데이터 스트림을 형성하며, 이를 통해 메시지가 병렬로 처리될 수 있다.

이러한 병렬 처리는 카프카의 성능을 극대화하는 핵심 요인이다.

파티션은 큐를 나눠서 병렬 처리를 가능하게 하는 기본 단위이며, 각 토픽은 하나 이상의 파티션으로 나뉘어져있다. 

이를 통해 메시지가 병렬로 처리될 수 있다.

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcBlHFJ%2FbtsCKry4TVy%2FWogosuf42VtkwqxBKvtV31%2Fimg.webp)

파티션은 순서를 보장하는 로그 구조를 가지고 있다. 이 구조 덕분에 각 메시지는 **파티션 내에 고유한 오프셋을 가지게 되고, 이 오프셋을 통해 로그의 위치를 정확하게 식별할 수 있다.**

<br>

### 순서를 보장하는 로그 구조

카프카의 파티션은 기본적으로 **로그 파일**처럼 작동한다. 이 로그 구조에서 각 메시지는 순차적으로 저장되며, 각 메시지에는 **고유한 오프셋** 값이 할당된다. 이 오프셋은 메시지의 위치를 나타내며, 카프카 시스템 내에서 메시지를 정확하게 식별하는 데 사용된다.

#### 파티션의 로그 구조 이해하기
- **offset 0부터 시작**: 카프카에서는 파티션의 각 메시지에 0부터 시작하는 순차적인 오프셋 번호를 할당한다.
- **메시지 추가시 오프셋 증가**: 새 메시지가 파티션에 추가될 때마다, 그 메시지는 마지막 메시지의 오프셋에 1을 더한 값이 할당된다. 예를 들어 message a 다음에 b를 저장하면 b에는 오프셋 1이 할당된다.
- **순서 보장**: 이 로그 구조 덕분에 파티션 내의 메시지는 항상 순차적으로 저장되며, 각 메시지의 순서는 그 오프셋 값으로 보장된다.

```
| Offset | Message |
|--------|-------------|
| 0 | Message A |
| 1 | Message B | 
| 2 | Message C | 
| 3 | Message D | 
| 4 | Message E |
```

**순서 보장이 중요한 이유가 무엇일까?**

메시지의 순서가 보장되므로, 컨슈머의 데이터는 정확한 순서대로 처리가 가능하다. 이는 **시계열 데이터, 트랜잭션 기록 등 순서가 중요한 데이터의 처리에 매우 중요하다.** 또한 특정 메시지에 문제가 발생했을 때, 그 메시지의 오프셋을 통해 정확하게 위치를 식별하고 문제를 분석할 수 있다.

파티션의 장점으로는 다양한 컨슈머가 서로 다른 파티션에서 동시에 데이터를 읽을 수 있게 해주는 **병렬 처리**를 통해서 속도를 크게 향상시킨다는 점과 하나의 파티션 내에서 메시지의 순서가 보장되어, 순차적인 데이터 처리가 필요할 때 유용한 **순서 보장**, 파티션을 여러 노드에 분산시켜 저장 가능하여 **확장성**에도 장점을 갖는다.
